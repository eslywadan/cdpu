<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Resource - List for Admin</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <script src="{{ url_for('static', filename='js/jquery-3.5.1.min.js') }}"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/kendo.common.min.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/kendo.blueopal.min.css') }}" />

    <script src="{{ url_for('static', filename='js/kendo.all.min.js') }}"></script>
    <script>
        //var dataSource = [{"A":"apple", "B":"ball", "C":"cake"},{"A":"apple2", "B":"ball2", "C":"cake"},{"A":"apple3", "B":"ball3", "C":"cake"}];
       var dataSource = {{accounts|safe}};
    </script>
</head>
<body>
{% if msg_type != "" %}
<div class="alert alert-{{msg_type}} alert-dismissible fade show" role="alert">
    {{ message }}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
{% endif %}
<h2>Resource</h2>
<a href="{{ url_for('acct_bp.get_index_page') }}">
    <span class="k-icon k-i-home"></span>    Home Menu
</a>
&nbsp;&nbsp;&nbsp;
<a href="{{ url_for('acct_bp.create_resource') }}">
    <span class="k-icon k-i-plus-circle"></span>    Create Resource
</a>
<br/>
<div id="grid"></div>
<script>
    $(document).ready(function () {
        $("#grid").kendoGrid({
            dataSource: {data:dataSource, pageSize: 10},
            height: 446,
            sortable: true,
            pageable: {
                refresh: true,
                pageSizes: true,
                buttonCount: 5
            },
			filterable: true, // 啟用過濾功能
            columns: [
                {
                    field: "CLIENT_ID",
                    title: "Resource Name"
                }, 
                {
                    field: "TYPE",
                    title: "Type"
                }, 
                {
                template: function(dataItem) {
                    if (dataItem['TYPE'] == 1) {
                        return "RESOURCE";
                    } else {
                        return "";
                    }
                },
                field: "TYPE",
                title: "Type Name"
                },
                {
                    field: "OWNER_USER_ID",
                    title: "Owner User Id"
                },
                {
                    field: "REGISTRY",
                    title: "Registry"
                },
                {
                    field: "CREATE_DTTM",
                    title: "產生日期時間"
                },
                {
                    template: function(dataItem) {
                        if (dataItem.OWNER_USER_ID.toString().toLowerCase() !== "system") {
                            var edit_root_url = "{{ url_for('acct_bp.edit_resource_for_admin', client_id='', type='') }}";
                            var del_root_url = "{{ url_for('acct_bp.delete_resource', client_id='', type='') }}";  
                            //針對斜線轉換成__SLASH__
                            var client_id = dataItem.CLIENT_ID.replace(/\//g, '__SLASH__');
                            var url = "<a href='" + edit_root_url.substr(0, edit_root_url.length - 1) + encodeURIComponent(client_id) + "/" + dataItem.TYPE + "'>" + 
                                      "<span class='k-icon k-i-track-changes-enable'></span> Edit </a>&nbsp;&nbsp;" + 
                                      "<a href='" + del_root_url.substr(0, del_root_url.length - 1) + encodeURIComponent(client_id) + "/" + dataItem.TYPE + "'>" + 
                                      "<span class='k-icon k-i-delete k-i-trash'></span> Delete</a>";                
                            //console.log("url:"+ url);
                            return url;
                        } else {
                            return ""
                        }
                    },
                    title: " "
                }
            ]
        });
    });
</script>
</body>
</html>